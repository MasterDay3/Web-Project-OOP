<!DOCTYPE html>
<html lang="uk">

<head>
  <meta charset="UTF-8">
  <title>Numerix ¬∑ Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="page-light">
  <header class="nav-bar">
    <div class="brand">
      <span class="brand-dot"></span>
      <span class="brand-name">Numerix</span>
    </div>
    <nav class="nav-links">
      <a href="{{ url_for('home') }}">–ö–æ–Ω–≤–µ—Ä—Ç–æ—Ä</a>
      <a href="{{ url_for('calculator_page') }}">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</a>
      <a href="{{ url_for('task_routes.tasks_page') }}">–ó–∞–¥–∞—á—ñ</a>
      <a href="{{ url_for('leaderboard_routes.leaderboard') }}">Leaderboard</a>
    </nav>
    <a class="ghost" href="{{ url_for('profile_routes.profile') }}">–ü—Ä–æ—Ñ—ñ–ª—å</a>
    <a class="cta-nav" href="{{ url_for('auth_routes.logout') }}">–í–∏–π—Ç–∏</a>
  </header>

  <main class="shell">
    <section class="hero">
      <p class="eyebrow">Welcome back</p>
      <h1>–ü—Ä–∏–≤—ñ—Ç, {{ current_user.username }}! üëã</h1>
    </section>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="glass-card dashboard-alert">
      {% for msg in messages %}<p>{{ msg }}</p>{% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <!-- –¢–æ–ø –∫–∞—Ä—Ç–∫–∏ -->
    <div class="db-top-grid">
      <div class="glass-card db-stat-card">
        <span class="db-stat-icon">‚ö°</span>
        <span class="db-stat-val">{{ current_user.xp }}</span>
        <span class="db-stat-lbl">XP</span>
      </div>
      <div class="glass-card db-stat-card">
        <span class="db-stat-icon">üéØ</span>
        <span class="db-stat-val">Lvl {{ current_user.level }}</span>
        <span class="db-stat-lbl">–†—ñ–≤–µ–Ω—å</span>
      </div>
      <div class="glass-card db-stat-card">
        <span class="db-stat-icon">üî•</span>
        <span class="db-stat-val">{{ current_user.streak }}</span>
        <span class="db-stat-lbl">–°—Ç—Ä—ñ–∫</span>
      </div>
      <div class="glass-card db-stat-card">
        <span class="db-stat-icon">‚úÖ</span>
        <span class="db-stat-val">{{ accuracy }}%</span>
        <span class="db-stat-lbl">–¢–æ—á–Ω—ñ—Å—Ç—å</span>
      </div>
      <div class="glass-card db-stat-card">
        <span class="db-stat-icon">üìã</span>
        <span class="db-stat-val">{{ tasks_today }} / {{ current_user.daily_goal }}</span>
        <span class="db-stat-lbl">–°—å–æ–≥–æ–¥–Ω—ñ</span>
      </div>
    </div>

    <!-- –ì—Ä–∞—Ñ—ñ–∫ 7 –¥–Ω—ñ–≤ -->
    <section class="glass-card db-chart-card">
      <h3>–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∑–∞ —Ç–∏–∂–¥–µ–Ω—å</h3>
      <div class="db-chart">
        {% set max_done = week | map(attribute='done') | max %}
        {% for day in week %}
        <div class="db-bar-wrap">
          <div class="db-bar-bg">
            <div class="db-bar {{ 'db-bar-met' if day.met else '' }}"
              style="height: {{ (day.done / max_done * 100) | int if max_done > 0 else 0 }}%">
            </div>
          </div>
          <span class="db-bar-val">{{ day.done }}</span>
          <span class="db-bar-lbl">{{ day.date }}</span>
        </div>
        {% endfor %}
      </div>
    </section>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å –ø–æ —Å–∏—Å—Ç–µ–º–∞—Ö -->
    <section class="glass-card db-progress-card">
      <h3>–ü—Ä–æ–≥—Ä–µ—Å –ø–æ —Å–∏—Å—Ç–µ–º–∞—Ö</h3>
      {% if progress %}
      {% for p in progress %}
      <div class="db-system-row">
        <span class="db-system-name">{{ p.system | capitalize }}</span>
        <div class="db-progress-bar-bg">
          <div class="db-progress-bar" style="width: {{ p.accuracy }}%"></div>
        </div>
        <span class="db-system-stat">{{ p.tasks_correct }}/{{ p.tasks_done }} ({{ p.accuracy }}%)</span>
      </div>
      {% endfor %}
      {% else %}
      <p style="color: var(--muted)">–©–µ –Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö ‚Äî –ø–æ—á–Ω–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è!</p>
      {% endif %}
    </section>

    <!-- –®–≤–∏–¥–∫–∏–π –¥–æ—Å—Ç—É–ø -->
    <div class="dashboard-grid">
      <article class="glass-card dashboard-tile">
        <h3>–ó–∞–¥–∞—á—ñ</h3>
        <p>–¢—Ä–µ–Ω—É–π —á–∏—Å–ª–æ–≤—ñ —Å–∏—Å—Ç–µ–º–∏ —â–æ–¥–Ω—è.</p>
        <a class="cta" href="{{ url_for('task_routes.tasks_page') }}">–ü–æ—á–∞—Ç–∏</a>
      </article>
      <article class="glass-card dashboard-tile">
        <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <p>–ì—Ä–∞—Ñ—ñ–∫–∏ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ —Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.</p>
        <a class="cta" href="{{ url_for('stats_routes.stats') }}">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</a>
      </article>
      <article class="glass-card dashboard-tile">
        <h3>Leaderboard</h3>
        <p>–î–∏–≤–∏—Å—å —Å–≤–æ—î –º—ñ—Å—Ü–µ –≤ —Ä–µ–π—Ç–∏–Ω–≥—É.</p>
        <a class="cta" href="{{ url_for('leaderboard_routes.leaderboard') }}">–í—ñ–¥–∫—Ä–∏—Ç–∏</a>
      </article>
      <article class="glass-card dashboard-tile">
        <h3>–ö–æ–Ω–≤–µ—Ä—Ç–æ—Ä</h3>
        <p>–ö–æ–Ω–≤–µ—Ä—Ç—É–π —á–∏—Å–ª–∞ –º—ñ–∂ —Å–∏—Å—Ç–µ–º–∞–º–∏.</p>
        <a class="cta" href="{{ url_for('home') }}">–í—ñ–¥–∫—Ä–∏—Ç–∏</a>
      </article>
      <article class="glass-card dashboard-tile">
        <h3>–ü—Ä–æ—Ñ—ñ–ª—å</h3>
        <p>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–∫–∞—É–Ω—Ç—É.</p>
        <a class="cta" href="{{ url_for('profile_routes.profile') }}">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</a>
      </article>
      <article class="glass-card dashboard-tile">
        <h3>–ü–æ–º–∏–ª–∫–∏</h3>
        <p>–ü–æ–≤—Ç–æ—Ä–∏ –∑–∞–¥–∞—á—ñ –Ω–∞ —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.</p>
        <a class="cta" href="{{ url_for('mistakes_routes.mistakes') }}">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</a>
      </article>
    </div>
  </main>

  <style>
    .db-top-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 14px;
      margin-bottom: 20px;
    }

    .db-stat-card {
      padding: 20px;
      display: grid;
      gap: 4px;
      text-align: center;
    }

    .db-stat-icon {
      font-size: 24px;
    }

    .db-stat-val {
      font-size: 26px;
      font-weight: 800;
      color: var(--accent);
    }

    .db-stat-lbl {
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
    }

    .db-chart-card {
      padding: 24px;
      margin-bottom: 20px;
    }

    .db-chart-card h3 {
      margin: 0 0 20px;
    }

    .db-chart {
      display: flex;
      gap: 12px;
      align-items: flex-end;
      height: 140px;
    }

    .db-bar-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      height: 100%;
    }

    .db-bar-bg {
      flex: 1;
      width: 100%;
      background: #f3f4f6;
      border-radius: 8px;
      display: flex;
      align-items: flex-end;
      overflow: hidden;
    }

    .db-bar {
      width: 100%;
      background: var(--accent);
      border-radius: 8px;
      min-height: 4px;
      transition: height .3s ease;
    }

    .db-bar-met {
      background: #22c55e;
    }

    .db-bar-val {
      font-size: 12px;
      font-weight: 700;
      color: var(--ink);
    }

    .db-bar-lbl {
      font-size: 11px;
      color: var(--muted);
    }

    .db-progress-card {
      padding: 24px;
      margin-bottom: 20px;
    }

    .db-progress-card h3 {
      margin: 0 0 16px;
    }

    .db-system-row {
      display: grid;
      grid-template-columns: 100px 1fr 120px;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .db-system-name {
      font-weight: 700;
    }

    .db-progress-bar-bg {
      height: 10px;
      background: #f3f4f6;
      border-radius: 99px;
      overflow: hidden;
    }

    .db-progress-bar {
      height: 100%;
      background: var(--accent);
      border-radius: 99px;
      transition: width .4s ease;
    }

    .db-system-stat {
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
      text-align: right;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }

    .dashboard-tile {
      padding: 20px;
      display: grid;
      gap: 10px;
    }

    .dashboard-tile h3 {
      margin: 0;
    }

    .dashboard-tile p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .dashboard-tile .cta {
      width: fit-content;
      text-decoration: none;
    }

    @media (max-width: 900px) {
      .db-top-grid {
        grid-template-columns: repeat(3, 1fr);
      }

      .dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      .db-top-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</body>

</html>